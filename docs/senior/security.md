<!--
 * Author  rhys.zhao
 * Date  2023-07-06 15:46:03
 * LastEditors  rhys.zhao
 * LastEditTime  2023-07-20 15:25:15
 * Description
-->

# Web 安全

常见的 Web 攻击方式有 XSS、CSRF、SQL 注入等。

## XSS

XSS（跨站脚本攻击）是一种常见的 Web 应用程序安全漏洞，攻击者通过向 Web 页面注入恶意脚本，使得这些恶意脚本在受害者的浏览器上执行。XSS 攻击通常发生在动态生成 Web 内容的地方，例如用户输入、评论、搜索功能等。

### XSS 攻击的类型

1. 存储型 XSS：攻击者将恶意脚本存储在 Web 应用程序的数据库中，当其他用户访问受感染的页面时，这些恶意脚本会从数据库中取出并在受害者的浏览器上执行。这可能导致用户的敏感信息被窃取，或者执行其他未经授权的操作。

2. 反射型 XSS：攻击者通过恶意链接或 URL 将恶意脚本注入到 URL 参数中，当用户点击这些链接时，恶意脚本会从 URL 中提取并在受害者的浏览器上执行。这种类型的 XSS 攻击通常需要用户点击特定的恶意链接才会触发。

3. DOM 型 XSS：DOM 型 XSS 攻击不涉及向服务器发送恶意脚本，而是利用客户端的漏洞。攻击者将恶意脚本直接注入到页面的 DOM 中，当页面被加载和处理时，恶意脚本会被执行。

### XSS 攻击的危害

1. 窃取用户的登录凭证和敏感信息。

2. 修改页面内容，误导用户，进行钓鱼攻击。

3. 在受害者的账户上执行未授权的操作，例如删除数据、更改设置等。

4. 劫持用户会话，获取用户权限。

### 防范措施

1. 输入验证和输出编码：对于用户输入的数据，应该进行严格的输入验证，确保只接受合法的输入。同时，在将用户输入的数据输出到页面上时，应使用适当的输出编码，以防止恶意脚本的注入。

2. 使用 HttpOnly 标志：将 Cookie 标记为 HttpOnly，这样浏览器将禁止通过 JavaScript 访问 Cookie，从而防止 XSS 攻击获取用户的 Cookie 信息。

3. Content Security Policy（CSP）：CSP 是一种安全头部，用于指定哪些资源可以在页面中加载，从而防止恶意脚本的执行。

4. 细化权限控制：确保用户只能访问其必要的资源，限制不受信任的用户执行敏感操作。

5. 定期更新和修复：及时更新 Web 应用程序和相关的库，以修复已知的漏洞。

6. 使用安全的开发框架和库：选择安全性有保障的开发框架和库，避免自行实现容易出现漏洞的功能。

## CSRF

CSRF（Cross-Site Request Forgery）跨站请求伪造是一种常见的 Web 应用程序安全漏洞，它利用了 Web 应用程序对用户在其他网站上的身份认证。攻击者通过构造恶意请求，使受害者在登录状态下不知情地执行未经授权的操作。

### CSRF 攻击的原理

1. 受害者登录状态：假设受害者在目标 Web 应用程序中已经登录，并且浏览器中保存了与该应用程序相关的认证信息（通常是通过 Cookie）。

2. 恶意网站构造请求：攻击者构造一个恶意网站，该网站包含一个特制的 HTML 页面或脚本，其中包含目标 Web 应用程序的请求，例如执行转账、更改密码等敏感操作的请求。这个请求会被自动触发。

3. 受害者访问恶意网站：受害者在浏览器中访问了恶意网站。由于网站中包含了对目标 Web 应用程序的请求，浏览器会自动将认证信息（Cookie）附加到请求中。

4. 自动发送恶意请求：受害者的浏览器自动发送了恶意请求，请求中包含了受害者的认证信息。由于目标 Web 应用程序无法区分请求是受害者自己发起的还是攻击者构造的，所以会以为是合法请求，并执行了未经授权的操作。

### CSRF 攻击的危害

1. 转账和支付：攻击者可以在受害者的账户中进行转账和支付，将资金转移到攻击者的账户中。

2. 更改密码：攻击者可以更改受害者的密码，从而控制其账户。

3. 修改个人信息：攻击者可以修改受害者的个人信息，损害受害者的声誉。

4. 删除数据：攻击者可以删除受害者的数据，造成数据丢失和损失。

### 防范措施

1. 使用 CSRF 令牌：在每个请求中包含一个 CSRF 令牌（也称为 Anti-CSRF Token），该令牌是一个随机生成的值，存储在用户会话中。服务器在接收到请求时验证令牌的有效性，如果令牌无效，则拒绝执行请求。

2. 启用 SameSite 属性：可以将 Cookie 的 SameSite 属性设置为 Strict 或 Lax，以限制在跨站请求中是否发送 Cookie，从而减少 CSRF 攻击的风险。

3. 使用 HTTP Referer 检查：服务器可以通过检查请求的 HTTP Referer 头部来验证请求来源是否合法。然而，这种方法可能不完全可靠，因为 HTTP Referer 头部有时可能被篡改。

4. 增加验证码：对于执行敏感操作的请求，可以要求用户输入验证码，确保只有真正的用户才能执行这些操作。

## SQL 注入

SQL 注入攻击是一种常见的 Web 应用程序安全漏洞，它允许攻击者通过向应用程序的输入字段插入恶意 SQL 代码，从而绕过输入验证，访问、修改或删除数据库中的数据，甚至控制整个数据库服务器。SQL 注入攻击发生在未能正确验证和转义用户输入的情况下，导致应用程序将用户输入作为 SQL 查询的一部分执行，从而产生安全漏洞。

### SQL 注入攻击的原理

1. 用户输入：Web 应用程序接收用户输入，例如表单、搜索字段、URL 参数等。

2. 恶意 SQL 注入：攻击者在用户输入中插入恶意 SQL 代码，例如在输入字段中输入' OR 1=1; --。

3. 未经转义的 SQL 查询：应用程序将用户输入的内容直接插入到 SQL 查询中，而没有进行充分的验证和转义。

4. 执行恶意 SQL 查询：由于恶意 SQL 代码的存在，SQL 查询变得不受控制，可能执行查询中的所有操作，例如获取所有数据、删除数据等。

5. 数据泄露或破坏：攻击者成功执行了恶意 SQL 查询，可以访问敏感数据、更改数据或破坏数据库。

### SQL 注入攻击的危害

1. 窃取敏感信息：攻击者可以窃取用户的登录凭证、个人信息和其他敏感数据。

2. 数据泄露：攻击者可以访问数据库中的所有数据，包括其他用户的数据。

3. 数据篡改：攻击者可以修改数据库中的数据，导致数据不一致或错误。

4. 数据删除：攻击者可以删除数据库中的数据，造成数据丢失。

### 防范措施

1. 使用参数化查询或预编译语句：不要将用户输入直接插入到 SQL 查询中，而是使用参数化查询（使用预处理语句和绑定参数）来将输入与 SQL 查询分离，确保输入不被当作代码执行。

2. 输入验证：对于用户输入，进行严格的输入验证，确保只接受预期的输入格式和范围。

3. 数据转义：在将用户输入用于动态生成 SQL 查询时，对用户输入进行转义，确保特殊字符被正确处理。

4. 使用最小特权原则：在数据库中使用有限的数据库用户权限，并确保 Web 应用程序只能访问它所需的最小数据库表和字段。

5. 错误处理：不要将详细的错误信息直接返回给用户，以防止攻击者从中获取有用的信息。
